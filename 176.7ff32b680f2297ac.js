(()=>{"use strict";const E=new Map([["Database","bg-blue-900 text-blue-200 border border-blue-700"],["HTTP","bg-green-900 text-green-200 border border-green-700"],["Error","bg-red-900 text-red-200 border border-red-700"],["Warning","bg-yellow-900 text-yellow-200 border border-yellow-700"],["ORM","bg-purple-900 text-purple-200 border border-purple-700"],["Migration","bg-indigo-900 text-indigo-200 border border-indigo-700"],["App","bg-cyan-900 text-cyan-200 border border-cyan-700"],["Security","bg-orange-900 text-orange-200 border border-orange-700"],["Validation","bg-pink-900 text-pink-200 border border-pink-700"],["Static","bg-gray-700 text-gray-200 border border-gray-600"],["Log","bg-gray-700 text-gray-200 border border-gray-600"]]),C=new Map([["Error","bg-red-900 text-red-200 border border-red-700"],["Warning","bg-yellow-900 text-yellow-200 border border-yellow-700"],["Information","bg-blue-900 text-blue-200 border border-blue-700"],["Debug","bg-gray-700 text-gray-300 border border-gray-600"],["Trace","bg-gray-700 text-gray-300 border border-gray-600"],["Critical","bg-red-900 text-red-200 border border-red-700"]]),D=new Map([["GET","bg-blue-900 text-blue-200 border border-blue-700"],["POST","bg-green-900 text-green-200 border border-green-700"],["PUT","bg-yellow-900 text-yellow-200 border border-yellow-700"],["PATCH","bg-purple-900 text-purple-200 border border-purple-700"],["DELETE","bg-red-900 text-red-200 border border-red-700"],["HEAD","bg-gray-700 text-gray-200 border border-gray-600"],["OPTIONS","bg-gray-700 text-gray-200 border border-gray-600"]]),b=new Map;function L(e){if(b.has(e))return b.get(e);try{const t=new Date(e),n=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),d=String(t.getDate()).padStart(2,"0"),r=String(t.getHours()).padStart(2,"0"),i=`${d}/${a}/${n}, ${r}:${String(t.getMinutes()).padStart(2,"0")}:${String(t.getSeconds()).padStart(2,"0")}`;return b.size<1e4&&b.set(e,i),i}catch{return e}}function O(e){return E.get(e)||E.get("Log")||""}function N(e){return C.get(e)||"bg-gray-700 text-gray-200 border border-gray-600"}function P(e){return e>=200&&e<300?"bg-green-900 text-green-200 border border-green-700":e>=300&&e<400?"bg-cyan-900 text-cyan-200 border border-cyan-700":e>=400&&e<500?"bg-yellow-900 text-yellow-200 border border-yellow-700":e>=500?"bg-red-900 text-red-200 border border-red-700":"bg-gray-700 text-gray-200 border border-gray-600"}function I(e){const t=e.toUpperCase();return D.get(t)||"bg-gray-700 text-gray-200 border border-gray-600"}function A(e){const t=e.Properties?.SourceContext||e.SourceContext||"";return t.includes("EntityFrameworkCore.Database")?"Database":t.includes("EntityFrameworkCore.Migrations")?"Migration":t.includes("EntityFrameworkCore")?"ORM":t.includes("AspNetCore.Hosting.Diagnostics")||t.includes("AspNetCore.Routing")||t.includes("AspNetCore.Mvc")?"HTTP":t.includes("DataProtection")?"Security":t.includes("StaticFiles")?"Static":t.includes("Lifetime")?"App":t.includes("Validation")?"Validation":"Error"===e.Level?"Error":"Warning"===e.Level?"Warning":"Log"}function H(e,t){if(!e)return"N/A";let n=e;return t&&"object"==typeof t&&Object.keys(t).forEach(a=>{const d=`{${a}}`,r=t[a];let s=r;"object"==typeof r&&null!==r&&(s=r.Name?r.Name:r.toString&&"[object Object]"!==r.toString()?r.toString():JSON.stringify(r)),n=n.replace(new RegExp(d,"g"),s)}),n}function $(e){if(!e)return e;const t=(e=e.replace(/^Executed DbCommand.*?\]/s,"").trim()).match(/SELECT\s+(.*?)\s+FROM/is),n=e.match(/FROM\s+\[?(?:dbo|[^\]]*)\]?\.\[?([^\]]+)\]?/i);let a=null;const d=e.toUpperCase().indexOf("WHERE");if(-1!==d){let c=e.length;const l=e.toUpperCase().indexOf("ORDER BY",d),g=e.toUpperCase().indexOf("GROUP BY",d),f=e.toUpperCase().indexOf("LIMIT",d);-1!==l&&(c=Math.min(c,l)),-1!==g&&(c=Math.min(c,g)),-1!==f&&(c=Math.min(c,f));const p=e.substring(d+5,c).trim();a=[e,p]}const r=e.match(/INSERT\s+INTO\s+\[?([^\]]+)\]?/i),s=e.match(/UPDATE\s+\[?([^\]]+)\]?/i),o=e.match(/DELETE\s+FROM\s+\[?([^\]]+)\]?/i);let i="";return t?(i+=`<select>SELECT ${t[1].split(",").length} cols</select> FROM <table>${n?n[1].replace(/[\[\]]/g,""):"Unknown"}</table>`,a&&(i+=` <where>WHERE ${a[1].replace(/[\[\]]/g,"").trim()}</where>`)):r?i=`<insert>INSERT INTO</insert> <table>${r[1].replace(/[\[\]]/g,"")}</table>`:s?(i=`<update>UPDATE</update> <table>${s[1].replace(/[\[\]]/g,"")}</table>`,a&&(i+=` <where>WHERE ${a[1].replace(/[\[\]]/g,"").trim()}</where>`)):o?(i=`<delete>DELETE FROM</delete> <table>${o[1].replace(/[\[\]]/g,"")}</table>`,a&&(i+=` <where>WHERE ${a[1].trim().replace(/[\[\]]/g,"")}</where>`)):i=e.substring(0,80)+"...",i}function F(e){const n=e.match(/^(\d{4}-\d{2}-\d{2})\s+(\d{2}:\d{2}:\d{2}\.\d+)\s+([+-]\d{2}:\d{2})\s+\[?(\w+)\]?\s+([\s\S]*)$/);if(!n)return null;const[,a,d,r,s,o]=n,i=`${a}T${d}${r}`;let c=function W(e){return e.startsWith("Executed DbCommand")?"EntityFrameworkCore.Database":e.startsWith("Request starting")||e.startsWith("Request finished")||e.startsWith("Executing endpoint")?"AspNetCore.Routing":""}(o);return{Timestamp:i,Level:_(s),SourceContext:c,Message:o,Properties:{StatusCode:"AspNetCore.Routing"===c?U(o):void 0,Method:v(o)}}}function U(e){const t=e.match(/-\s*(\d{3})\s*-/);if(t){const n=parseInt(t[1],10);if(n>=200&&n<=500)return n}return null}function v(e){const t=e.match(/\b(GET|POST|PUT|DELETE|PATCH|OPTIONS|HEAD)\b/);return t?t[1]:null}function _(e){switch(e){case"WRN":return"Warning";case"ERR":return"Error";case"INF":return"Information";case"DBG":return"Debug";case"FTL":return"Fatal";default:return e}}self.onmessage=e=>{const{type:t,content:n,chunkSize:a}=e.data;"PARSE_LOG"===t&&n&&function k(e,t){const n=[],a=e.split("\n"),d=a.length;for(let r=0;r<a.length;r++){const s=a[r];if(s.trim())try{let o;try{o=JSON.parse(s)}catch{if(o=F(s),!o)continue}const i=o.Timestamp||o.timestamp||(new Date).toISOString(),l=new Date(i).getHours(),g=A(o),f=O(g),p=o.Level||"Information",Y=N(p),x=H(o.MessageTemplate||o.Message,o.Properties);let m,S,y,T;const u=o.Properties||{};m=u.StatusCode||void 0,m&&(S=P(m)),"HTTP"===g&&(y=u.Method||void 0,y&&(T=I(y)));const j=u.RequestId||u.TraceId||u.CorrelationId||u.CorrelationIdentifier||void 0;let h,M,w;"Database"===g&&(h=u.CommandText||x,h&&(M=$(h)),w=u.RequestPath||void 0),n.push({timestamp:i,formattedDate:L(i),hour:l,data:o,raw:s,type:g,typeClass:f,level:p,levelClass:Y,message:x,statusCode:m,statusCodeClass:S,httpMethod:y,httpMethodClass:T,correlationId:j,sql:h,sqlFormatted:M,requestPath:w}),r%t===0&&self.postMessage({processed:r,total:d,logs:n.slice()})}catch{}}n.sort((r,s)=>new Date(s.timestamp).getTime()-new Date(r.timestamp).getTime()),self.postMessage({processed:d,total:d,logs:n})}(n,a||5e3)}})();